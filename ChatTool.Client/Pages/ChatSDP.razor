@page "/ChatSDP"

@inject IJSRuntime JS

<PageTitle>ChatSDP</PageTitle>

<h3>Chat with SDP</h3>

@if (DataChannelState == "closed")
{
    <button @onclick="Init">Initialize</button>
    <button @onclick="CreateOffer">Create Offer (copy and send to remote)</button>
    <button @onclick="AcceptOffer">Accept Remote Offer (paste remote offer & create answer)</button>
    <button @onclick="AcceptAnswer">Accept Remote Answer (paste remote answer)</button>
    <button @onclick="Close">Close</button>

    <p>Data channel state: <strong>@DataChannelState</strong></p>

    <ul>
        <li>Click Initialize on both peers.</li>
        <li>Peer A: Click: Create Offer → Copy Local SDP → send to Peer B.</li>
        <li>Peer B: Paste Remote → Click: Accept Remote Offer → Copy Local SDP and send to Peer A.</li>
        <li>Peer A: Paste Remote Answer → Click: Accept Remote Answer → Wait for "Data channel open"</li>
    </ul>

    <h3>Local SDP (base64) — copy this to remote</h3>
    <textarea readonly style="width:100%;height:160px" @bind="LocalSdp"></textarea>

    <h3>Remote SDP (paste remote offer or answer here)</h3>
    <textarea style="width:100%;height:160px" @bind="RemoteSdp"></textarea>

    <h5>Log</h5>
    <ul>
        @foreach (string m in LogMessages)
        {
            <li>@m</li>
        }
    </ul>
}

@if (DataChannelState == "open")
{
    <h4>Send message</h4>
    <input @bind="Message" @bind:event="oninput" @onkeydown="SendOnKeyDown" placeholder="Type message..." style="width:70%" />
    <button @onclick="OnSend">Send</button>

    <h5>Messages</h5>
    <ul>
        @foreach (string m in Messages)
        {
            <li>@m</li>
        }
    </ul>
}